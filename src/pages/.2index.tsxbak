import React from 'react';
import clsx from 'clsx';
import Layout from '@theme/Layout';
import useDocusaurusContext from '@docusaurus/useDocusaurusContext';
import styles from './index.module.css';
import HomepageContent from './__index.md';
import blogPosts from '@site/.docusaurus/docusaurus-plugin-content-blog/default/blog-post-list-prop-default.json';
import type { BlogPost } from '@site/.docusaurus/docusaurus-plugin-content-blog/default/blog-post-list-prop-default.json';
import HomepageHeader from '../components/HomepageHeader';
import BlogCard from '../components/BlogCard';
import useIsBrowser from '@docusaurus/useIsBrowser';

export default function Home() {
  const { siteConfig } = useDocusaurusContext();
  const recentPosts = blogPosts?.items?.length > 0 ? blogPosts.items.slice(0, 12) : [];
  const isBrowser = useIsBrowser();

  // Log posts for debugging
  console.log('Recent Posts:', recentPosts);

  // Safely handle posts with missing frontMatter or image
  const postsWithImages = recentPosts.map(post => {
    const frontMatter = post.frontMatter || {};
    const image = frontMatter.image || '/img/proudamerica.webp';
    console.log(`Post: ${post.title}, frontMatter:`, frontMatter, 'Image:', image);
    return {
      ...post,
      frontMatter: {
        ...frontMatter,
        image,
      },
    };
  });

  return (
    <Layout description={siteConfig.tagline}>
      <HomepageHeader />
      <main className={styles.main}>
        <HomepageContent />
        <section className={styles.blogSection}>
          <div className="container">
            <h2>Latest Articles & Analysis</h2>
            {postsWithImages.length > 0 ? (
              <div className={clsx('row', styles.blogRow)}>
                {postsWithImages.map((post: BlogPost, index: number) => (
                  <div key={index} className="col col--4">
                    <BlogCard
                      post={{
                        title: post.title,
                        permalink: post.permalink,
                        date: post.date,
                        frontMatter: {
                          image: post.frontMatter.image,
                        },
                      }}
                    />
                  </div>
                ))}
              </div>
            ) : (
              <p>No blog posts available.</p>
            )}
          </div>
        </section>
      </main>
      {isBrowser && (
        <div id="navbar-realtime-clock" className={styles.clockWrapper}></div>
      )}
    </Layout>
  );
}
